{% extends "builder/base.html" %}
{% load static %}

{% block title %}Edit Resume{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/resume-edit.css' %}" />

<section class="card">
  <h2 class="page-title-gradient">Edit: {{ resume.title }}</h2>

  {% if errors %}
  <div class="card subtle validation-errors-box">
    <strong class="validation-errors-title">âš ï¸ Validation Errors:</strong>
    <ul class="validation-errors-list">
      {% for field, message in errors.items %}
      <li>{{ message }}</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <div class="toolbar edit-toolbar" role="region" aria-label="Actions">
    <a class="btn" href="{% url 'resume_preview' resume.id %}">ğŸ‘ï¸ Preview</a>
    <a class="btn" href="{% url 'export_pdf' resume.id %}">ğŸ“„ Export PDF</a>
    <a class="btn" href="{% url 'export_docx' resume.id %}">ğŸ“ Export DOCX</a>
  </div>

  <details class="card subtle">
    <summary class="voice-details-summary"><strong>ğŸ¤ Voice input</strong> <span class="voice-details-hint">(works in Chrome/Edge)</span></summary>
    <p class="muted">
      Click a text field, then press Start and speak. It will insert text into the selected field.
    </p>
    <div class="row voice-controls-row">
      <button class="btn primary" type="button" id="voiceMode">ğŸ™ï¸ Voice Mode</button>
      <button class="btn" type="button" id="startVoice">â–¶ï¸ Start</button>
      <button class="btn" type="button" id="stopVoice">â¹ï¸ Stop</button>

      <label class="muted narrator-label">
        <input type="checkbox" id="narratorToggle" class="narrator-checkbox" checked />
        ğŸ”Š Narrator
      </label>

      <span class="muted" id="voiceStatus" aria-live="polite"></span>
    </div>
    <div id="liveTranscript" class="muted"></div>
  </details>

  <!-- Case Mode Indicator -->
  <div class="case-mode-wrapper">
    <span class="muted case-mode-label">Typing mode:</span>
    <span id="caseModeIndicator">(Original)</span>
  </div>

  <form method="post" class="form" id="resumeForm">
    {% csrf_token %}

    <h3>Basics</h3>

    <p>
      <label for="title"><strong>Resume title</strong> *</label><br />
      <input id="title" name="title" class="input {% if errors.title %}field-error{% endif %}"
        value="{{ resume.title }}" />
      {% if errors.title %}
    <div class="error-message">{{ errors.title }}</div>{% endif %}
    </p>

    <div class="grid2">
      <p>
        <label for="full_name"><strong>Full name</strong> *</label><br />
        <input id="full_name" name="full_name" class="input {% if errors.full_name %}field-error{% endif %}"
          value="{{ resume.full_name }}" />
        {% if errors.full_name %}
      <div class="error-message">{{ errors.full_name }}</div>{% endif %}
      </p>

      <p>
        <label for="email"><strong>Email</strong> *</label><br />
        <input id="email" name="email" class="input {% if errors.email %}field-error{% endif %}"
          value="{{ resume.email }}" />
        {% if errors.email %}
      <div class="error-message">{{ errors.email }}</div>{% endif %}
      </p>
    </div>

    <div class="grid2">
      <p>
        <label for="phone"><strong>Phone</strong> *</label><br />
        <input id="phone" name="phone" class="input {% if errors.phone %}field-error{% endif %}"
          value="{{ resume.phone }}" />
        {% if errors.phone %}
      <div class="error-message">{{ errors.phone }}</div>{% endif %}
      </p>

      <p>
        <label for="location"><strong>Location</strong></label><br />
        <input id="location" name="location" class="input" value="{{ resume.location }}" />
      </p>
    </div>

    <div class="grid2">
      <p>
        <label for="linkedin"><strong>LinkedIn</strong></label><br />
        <input id="linkedin" name="linkedin" class="input" value="{{ resume.linkedin }}" />
      </p>

      <p>
        <label for="github"><strong>GitHub</strong></label><br />
        <input id="github" name="github" class="input" value="{{ resume.github }}" />
      </p>
    </div>

    <p>
      <label for="summary"><strong>Summary</strong></label><br />
      <textarea id="summary" name="summary" rows="4" class="input">
{{ resume.summary }}</textarea>
    </p>

    <h3>Education</h3>
    <div id="educationList"></div>
    <button class="btn" type="button" id="addEducation">+ Add Education</button>

    <h3>Experience</h3>
    <div id="experienceList"></div>
    <button class="btn" type="button" id="addExperience">
      + Add Experience
    </button>

    <h3>Projects</h3>
    <div id="projectsList"></div>
    <button class="btn" type="button" id="addProject">+ Add Project</button>

    <h3>Skills</h3>
    <p class="muted">Enter one skill per line.</p>
    <textarea id="skillsText" rows="6" class="mono input" aria-label="Skills"></textarea>

    <!-- Hidden JSON fields -->
    <input type="hidden" name="education_json" id="education_json" />
    <input type="hidden" name="experience_json" id="experience_json" />
    <input type="hidden" name="projects_json" id="projects_json" />
    <input type="hidden" name="skills_json" id="skills_json" />

    <div class="actions">
      <button class="btn primary" type="submit" name="action" value="save">
        Save
      </button>
      <button class="btn" type="submit" name="action" value="preview">
        Save & Preview
      </button>
    </div>
  </form>
</section>

<!-- JSON blobs (so VS Code doesn't complain + JS stays valid) -->
<script id="education-data" type="application/json">
  {{ education_json|safe }}
</script>
<script id="experience-data" type="application/json">
  {{ experience_json|safe }}
</script>
<script id="projects-data" type="application/json">
  {{ projects_json|safe }}
</script>
<script id="skills-data" type="application/json">
  {{ skills_json|safe }}
</script>

{% endblock %} {% block scripts %}

<script type="module" src="{% static 'js/resume-edit.js' %}"></script>

{% endblock %}